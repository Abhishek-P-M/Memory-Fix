<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Fix | Numbers</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f0f0; margin:0; padding:0; }
header { background:#2c3e50; color:#fff; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; }
nav a { color:#fff; margin-left:1rem; text-decoration:none; font-weight:bold; }
nav a:hover { text-decoration:underline; }
main { padding:2rem; max-width:900px; margin:auto; }
button { padding:0.5rem 1rem; margin:5px; border:none; border-radius:8px; background:#3498db; color:#fff; cursor:pointer; }
button:hover { background:#2980b9; }
#generatedNumber { font-size:2rem; font-weight:bold; text-align:center; margin:1rem; padding:1rem; background:#fff; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
#numberList { margin-top:1rem; background:#fff; padding:1rem; border-radius:12px; min-height:100px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
label { display:block; margin:10px 0; }
</style>
</head>
<body>

<header>
<h1>Memory Fix</h1>
<nav>
  <a href="index.html">Home</a>
  <a href="disciplines.html">Disciplines</a>
  <a href="numbers.html">Numbers</a>
  <a href="stats.html">Stats</a>
  <a href="about.html">About</a>
</nav>
</header>

<main>
<h2>Random Number Memorization</h2>

<label>Choose number type:
<select id="numberType">
  <option value="2digit">2-Digit</option>
  <option value="3digit">3-Digit</option>
  <option value="custom">Custom Prefix 3-Digit</option>
</select>
</label>

<label id="prefixLabel" style="display:none;">Prefix (0-9):
<input type="number" id="prefix" min="0" max="9" value="0"></label>

<label>Number of numbers:
<select id="deckSize">
  <option value="10">10</option>
  <option value="20">20</option>
  <option value="50">50</option>
</select>
</label>

<button onclick="startMemorization()">Start</button>

<div id="memorization" style="display:none;">
<p>Memorize this number:</p>
<div id="generatedNumber"></div>
<button onclick="nextNumber()">Next</button>
<p>Time elapsed: <span id="memTime">0</span> s</p>
</div>

<div id="recollection" style="display:none;">
<p>Recollection phase (1 min). Try to recall the numbers. <button onclick="skipRecollection()">Skip</button></p>
</div>

<div id="reproduction" style="display:none;">
<p>Reproduction phase: Drag the numbers into correct order.</p>
<div id="placeholders" style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:10px;"></div>
<div id="deck" style="display:flex; flex-wrap:wrap; gap:5px;"></div>
<button onclick="submitReproduction()">Submit</button>
</div>

<div id="results" style="display:none;">
<p id="score"></p>
</div>

<div id="numberList"></div>

<script>
let chosenNumbers=[],deckSize=10,memIndex=0,seconds=0,memTimer=[],userChoices=[];

// Show prefix only if custom
document.getElementById('numberType').addEventListener('change', e=>{
  document.getElementById('prefixLabel').style.display = e.target.value==='custom'?'inline-block':'none';
});

function generateNumbers(type,n,prefix=0){
  const nums=[];
  for(let i=0;i<n;i++){
    let num;
    if(type==='2digit') num=Math.floor(Math.random()*90)+10;
    else if(type==='3digit') num=Math.floor(Math.random()*1000).toString().padStart(3,'0');
    else num=(prefix.toString() + Math.floor(Math.random()*100).toString().padStart(2,'0'));
    nums.push(num);
  }
  return nums;
}

function startMemorization(){
  deckSize=parseInt(document.getElementById('deckSize').value);
  const type=document.getElementById('numberType').value;
  const prefix=parseInt(document.getElementById('prefix').value)||0;
  chosenNumbers=generateNumbers(type,deckSize,prefix);
  memIndex=0; seconds=0; userChoices=[];
  document.getElementById('memorization').style.display='block';
  document.getElementById('recollection').style.display='none';
  document.getElementById('reproduction').style.display='none';
  document.getElementById('results').style.display='none';
  document.getElementById('numberList').innerHTML='';
  document.getElementById('memTime').innerText='0';
  displayMemorizeNumber();
  memTimer=setInterval(()=>{seconds++; document.getElementById('memTime').innerText=seconds;},1000);
}

function displayMemorizeNumber(){
  document.getElementById('generatedNumber').innerText=chosenNumbers[memIndex];
}

function nextNumber(){
  memIndex++;
  if(memIndex>=chosenNumbers.length){
    clearInterval(memTimer);
    document.getElementById('memorization').style.display='none';
    startRecollection();
  } else displayMemorizeNumber();
}

function startRecollection(){
  document.getElementById('recollection').style.display='block';
  setTimeout(()=>{ document.getElementById('recollection').style.display='none'; startReproduction(); },60000);
}
function skipRecollection(){ document.getElementById('recollection').style.display='none'; startReproduction(); }

function startReproduction(){
  document.getElementById('reproduction').style.display='block';
  renderReproduction();
}
function renderReproduction(){
  const placeholdersDiv=document.getElementById('placeholders');
  const deckDiv=document.getElementById('deck');
  placeholdersDiv.innerHTML=''; deckDiv.innerHTML=''; userChoices=Array(chosenNumbers.length).fill(null);

  chosenNumbers.forEach((_,i)=>{
    const ph=document.createElement('div'); ph.className='number-placeholder';
    ph.dataset.index=i;
    ph.ondragover=e=>e.preventDefault();
    ph.ondrop=e=>{
      const idx=e.dataTransfer.getData('text'); 
      const div=document.getElementById('num-'+idx);
      ph.innerHTML=''; ph.appendChild(div); userChoices[i]=parseInt(idx);
    };
    placeholdersDiv.appendChild(ph);
  });

  chosenNumbers.forEach((num,i)=>{
    const div=document.createElement('div');
    div.id='num-'+i; div.className='number-card';
    div.innerText=num; div.draggable=true;
    div.ondragstart=e=>e.dataTransfer.setData('text',i);
    deckDiv.appendChild(div);
  });
}

function submitReproduction(){
  let correct=0;
  userChoices.forEach((u,i)=>{ if(u!==null && chosenNumbers[u]===chosenNumbers[i]) correct++; });
  let score10=((correct/chosenNumbers.length)*10).toFixed(2);
  document.getElementById('score').innerText=`Correct: ${correct}/${chosenNumbers.length} â†’ Score: ${score10}/10`;
  document.getElementById('reproduction').style.display='none';
  document.getElementById('results').style.display='block';
  saveNumbersStats(score10,seconds,document.getElementById('numberType').value);
}

function saveNumbersStats(score,time,mode){
  let stats=JSON.parse(localStorage.getItem('numbersStats'))||[];
  stats.push({date:new Date().toISOString().split('T')[0], mode:mode, score:parseFloat(score), time:time});
  localStorage.setItem('numbersStats',JSON.stringify(stats));
}
</script>

</body>
</html>
