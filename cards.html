<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Fix | Cards</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background: #f4f6f9; margin:0; padding:0; }
header { background:#2c3e50; color:#fff; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.5rem; }
nav a { color:#fff; margin-left:1.5rem; text-decoration:none; font-weight:500; }
nav a:hover { text-decoration:underline; }
main { padding:2rem; max-width:1000px; margin:auto; }
button { padding:0.5rem 1rem; border:none; border-radius:8px; background:#3498db; color:#fff; cursor:pointer; margin:5px; }
button:hover { background:#2980b9; }
.card { width:60px; height:90px; border:1px solid #333; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:grab; background:#fff; font-weight:bold; font-size:1rem; }
.card-placeholder { width:60px; height:90px; border:2px dashed #999; border-radius:8px; display:flex; align-items:center; justify-content:center; background:#fff; }
#placeholders,#deck { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
#memorization,#recollection,#reproduction,#results { margin-top:20px; }
</style>
</head>
<body>

<header>
  <h1>Memory Fix</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="disciplines.html">Disciplines</a>
    <a href="cards.html">Cards</a>
    <a href="stats.html">Stats</a>
    <a href="about.html">About</a>
  </nav>
</header>

<main>
  <h2>Cards Memorization</h2>

  <label>Choose Deck Size:
    <select id="deckSize">
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="30">30</option>
      <option value="52" selected>52</option>
    </select>
  </label>
  <button onclick="startMemorization()">Start</button>

  <!-- Memorization -->
  <div id="memorization" style="display:none;">
    <h3>Memorization</h3>
    <div id="memorizeCard" class="card"></div>
    <button onclick="nextCard()">Next</button>
    <p>Time: <span id="memTime">0</span> s</p>
  </div>

  <!-- Recollection -->
  <div id="recollection" style="display:none;">
    <h3>Recollection (1 min)</h3>
    <p>Try to recall the order of cards. <button onclick="skipRecollection()">Skip</button></p>
  </div>

  <!-- Reproduction -->
  <div id="reproduction" style="display:none;">
    <h3>Reproduction Phase</h3>
    <div id="placeholders"></div>
    <div id="deck"></div>
    <button onclick="submitReproduction()">Submit</button>
  </div>

  <!-- Results -->
  <div id="results" style="display:none;">
    <h3>Results</h3>
    <p id="score"></p>
  </div>
</main>

<script>
const suits=['hearts','diamonds','clubs','spades'];
const values=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
let fullDeck=[],chosenCards=[],deckSize=52;
let memorizeIndex=0,memTimer,seconds=0;
let userChoices=[];

function generateDeck(){
  fullDeck=[];
  suits.forEach(s=>{
    values.forEach(v=>{
      fullDeck.push({suit:s,value:v,color:(s==='hearts'||s==='diamonds')?'red':'black'});
    });
  });
}

function pickRandomDeck(n){
  const shuffled=[...fullDeck].sort(()=>Math.random()-0.5);
  chosenCards=shuffled.slice(0,n);
}

function startMemorization(){
  deckSize=parseInt(document.getElementById('deckSize').value);
  generateDeck();
  pickRandomDeck(deckSize);
  memorizeIndex=0;
  seconds=0;
  document.getElementById('memorization').style.display='block';
  document.getElementById('recollection').style.display='none';
  document.getElementById('reproduction').style.display='none';
  document.getElementById('results').style.display='none';
  document.getElementById('memTime').innerText='0';
  displayMemorizeCard();
  memTimer=setInterval(()=>{seconds++;document.getElementById('memTime').innerText=seconds;},1000);
}

function displayMemorizeCard(){
  const cardDiv=document.getElementById('memorizeCard');
  const card=chosenCards[memorizeIndex];
  cardDiv.innerHTML=`${card.value} ${getSuitSymbol(card.suit)}`;
  cardDiv.style.color=card.color;
}

function nextCard(){
  memorizeIndex++;
  if(memorizeIndex>=chosenCards.length){
    clearInterval(memTimer);
    document.getElementById('memorization').style.display='none';
    startRecollection();
  } else displayMemorizeCard();
}

function startRecollection(){
  document.getElementById('recollection').style.display='block';
  setTimeout(()=>{
    document.getElementById('recollection').style.display='none';
    startReproduction();
  },60000); // 1 min
}

function skipRecollection(){
  document.getElementById('recollection').style.display='none';
  startReproduction();
}

function startReproduction(){
  document.getElementById('reproduction').style.display='block';
  renderReproduction();
}

function renderReproduction(){
  const placeholdersDiv=document.getElementById('placeholders');
  const deckDiv=document.getElementById('deck');
  placeholdersDiv.innerHTML='';
  deckDiv.innerHTML='';
  userChoices=Array(chosenCards.length).fill(null);

  chosenCards.forEach((_,i)=>{
    const ph=document.createElement('div');
    ph.className='card-placeholder';
    ph.dataset.index=i;
    ph.ondragover=e=>e.preventDefault();
    ph.ondrop=e=>{
      const cardIndex=e.dataTransfer.getData('text');
      const cardDiv=document.getElementById('card-'+cardIndex);
      ph.innerHTML='';
      ph.appendChild(cardDiv);
      userChoices[i]=parseInt(cardIndex);
    };
    placeholdersDiv.appendChild(ph);
  });

  chosenCards.forEach((card,i)=>{
    const cardDiv=document.createElement('div');
    cardDiv.id='card-'+i;
    cardDiv.className='card';
    cardDiv.draggable=true;
    cardDiv.innerHTML=`${card.value} ${getSuitSymbol(card.suit)}`;
    cardDiv.style.color=card.color;
    cardDiv.ondragstart=e=>{ e.dataTransfer.setData('text',i); };
    deckDiv.appendChild(cardDiv);
  });
}

function submitReproduction(){
  let correct=0;
  userChoices.forEach((userIdx,i)=>{
    if(userIdx!==null && chosenCards[userIdx]===chosenCards[i]) correct++;
  });
  let score10=((correct/chosenCards.length)*10).toFixed(2);
  document.getElementById('score').innerText=`Correct: ${correct}/${chosenCards.length} → Score: ${score10}/10`;
  document.getElementById('reproduction').style.display='none';
  document.getElementById('results').style.display='block';
  saveCardsStats(parseFloat(score10),seconds,deckSize);
}

function saveCardsStats(score,time,deck){
  let cardsStats=JSON.parse(localStorage.getItem('cardsStats'))||[];
  cardsStats.push({
    date:new Date().toISOString().split('T')[0],
    deck:deck,
    score:score,
    time:time
  });
  localStorage.setItem('cardsStats',JSON.stringify(cardsStats));
}

function getSuitSymbol(suit){
  switch(suit){
    case 'hearts': return '♥';
    case 'diamonds': return '♦';
    case 'clubs': return '♣';
    case 'spades': return '♠';
  }
}
</script>

</body>
</html>
