<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Fix | Cards</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    margin:0; padding:20px;
    background: linear-gradient(135deg, #f0f9ff, #cbebff);
    color:#333;
  }

  h2 {
    color:#2c3e50; font-size:32px; margin-bottom:20px;
  }

  select, input {
    margin:8px; padding:8px 12px;
    font-size:16px; border:2px solid #ccc; border-radius:8px;
    outline:none; transition:0.2s;
  }

  select:focus, input:focus {
    border-color:#3498db;
    box-shadow: 0 0 6px rgba(52,152,219,0.4);
  }

  button {
    margin:10px; padding:12px 24px;
    font-size:18px; font-weight:bold;
    border:none; border-radius:12px; cursor:pointer;
    background: linear-gradient(90deg,#27ae60,#2ecc71); color:white;
    transition: transform 0.2s, opacity 0.2s;
  }

  button:hover { transform:scale(1.05); opacity:0.9; }
  button:active { transform:scale(0.95); }

  #memorization, #recollection, #reproduction, #results {
    margin-top:20px;
    padding:15px;
    background:white; border-radius:12px;
    box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
  }

  .card {
    width:60px; height:90px;
    border-radius:12px; display:flex;
    align-items:center; justify-content:center;
    cursor:grab; font-weight:bold; font-size:1rem;
    background:white; box-shadow:0 4px 6px rgba(0,0,0,0.2);
    margin:5px;
  }

  .card-placeholder {
    width:60px; height:90px;
    border:2px dashed #999; border-radius:12px;
    display:flex; align-items:center; justify-content:center;
    background:#f0f0f0; margin:5px;
  }

  #placeholders, #deck {
    display:flex; flex-wrap:wrap; justify-content:center;
    gap:10px; margin-bottom:20px;
  }

  #memTime { font-weight:bold; color:#27ae60; }
</style>
</head>
<body>

<h2>Cards Memorization</h2>

<label>Choose Deck Size:
  <select id="deckSize">
    <option value="10">10</option>
    <option value="20">20</option>
    <option value="30">30</option>
    <option value="52" selected>52</option>
  </select>
</label>
<button onclick="startMemorization()">Start</button>

<!-- Memorization -->
<div id="memorization" style="display:none;">
  <h3>Memorization</h3>
  <div id="memorizeCard" class="card"></div>
  <button onclick="nextCard()">Next</button>
  <p>Time: <span id="memTime">0</span> s</p>
</div>

<!-- Recollection -->
<div id="recollection" style="display:none;">
  <h3>Recollection (1 min)</h3>
  <p>Try to recall the order of cards. <button onclick="skipRecollection()">Skip</button></p>
</div>

<!-- Reproduction -->
<div id="reproduction" style="display:none;">
  <h3>Reproduction Phase</h3>
  <div id="placeholders"></div>
  <div id="deck"></div>
  <button onclick="submitReproduction()">Submit</button>
</div>

<!-- Results -->
<div id="results" style="display:none;">
  <h3>Results</h3>
  <p id="score"></p>
</div>

<script>
const suits=['hearts','diamonds','clubs','spades'];
const values=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
let fullDeck=[],chosenCards=[],deckSize=52;
let memorizeIndex=0,memTimer,seconds=0;
let userChoices=[];

function generateDeck(){
  fullDeck=[];
  suits.forEach(s=>{
    values.forEach(v=>{
      fullDeck.push({suit:s,value:v,color:(s==='hearts'||s==='diamonds')?'red':'black'});
    });
  });
}

function pickRandomDeck(n){
  const shuffled=[...fullDeck].sort(()=>Math.random()-0.5);
  chosenCards=shuffled.slice(0,n);
}

function startMemorization(){
  deckSize=parseInt(document.getElementById('deckSize').value);
  generateDeck();
  pickRandomDeck(deckSize);
  memorizeIndex=0;
  seconds=0;
  document.getElementById('memorization').style.display='block';
  document.getElementById('recollection').style.display='none';
  document.getElementById('reproduction').style.display='none';
  document.getElementById('results').style.display='none';
  document.getElementById('memTime').innerText='0';
  displayMemorizeCard();
  memTimer=setInterval(()=>{seconds++;document.getElementById('memTime').innerText=seconds;},1000);
}

function displayMemorizeCard(){
  const cardDiv=document.getElementById('memorizeCard');
  const card=chosenCards[memorizeIndex];
  cardDiv.innerHTML=`${card.value} ${getSuitSymbol(card.suit)}`;
  cardDiv.style.color=card.color;
}

function nextCard(){
  memorizeIndex++;
  if(memorizeIndex>=chosenCards.length){
    clearInterval(memTimer);
    document.getElementById('memorization').style.display='none';
    startRecollection();
  } else displayMemorizeCard();
}

function startRecollection(){
  document.getElementById('recollection').style.display='block';
  setTimeout(()=>{
    document.getElementById('recollection').style.display='none';
    startReproduction();
  },60000);
}

function skipRecollection(){
  document.getElementById('recollection').style.display='none';
  startReproduction();
}

function startReproduction(){
  document.getElementById('reproduction').style.display='block';
  renderReproduction();
}

function renderReproduction(){
  const placeholdersDiv=document.getElementById('placeholders');
  const deckDiv=document.getElementById('deck');
  placeholdersDiv.innerHTML='';
  deckDiv.innerHTML='';
  userChoices=Array(chosenCards.length).fill(null);

  // Create placeholders
  chosenCards.forEach((_,i)=>{
    const ph=document.createElement('div');
    ph.className='card-placeholder';
    ph.dataset.index=i;
    ph.ondragover=e=>e.preventDefault();
    ph.ondrop=e=>{
      const cardIndex=e.dataTransfer.getData('text');
      const cardDiv=document.getElementById('card-'+cardIndex).cloneNode(true); // clone card
      cardDiv.id='card-'+cardIndex+'-clone';
      ph.innerHTML='';
      ph.appendChild(cardDiv);
      userChoices[i]=parseInt(cardIndex);
    };
    placeholdersDiv.appendChild(ph);
  });

  // Create deck cards
  chosenCards.forEach((card,i)=>{
    const cardDiv=document.createElement('div');
    cardDiv.id='card-'+i;
    cardDiv.className='card';
    cardDiv.draggable=true;
    cardDiv.innerHTML=`${card.value} ${getSuitSymbol(card.suit)}`;
    cardDiv.style.color=card.color;
    cardDiv.ondragstart=e=>{ e.dataTransfer.setData('text',i); };
    deckDiv.appendChild(cardDiv);
  });
}

function submitReproduction(){
  let correct=0;
  userChoices.forEach((userIdx,i)=>{
    if(userIdx!==null &&
      chosenCards[userIdx].value===chosenCards[i].value &&
      chosenCards[userIdx].suit===chosenCards[i].suit
    ) correct++;
  });
  let score10=((correct/chosenCards.length)*10).toFixed(2);
  document.getElementById('score').innerText=`Correct: ${correct}/${chosenCards.length} → Score: ${score10}/10`;
  document.getElementById('reproduction').style.display='none';
  document.getElementById('results').style.display='block';
  saveCardsStats(parseFloat(score10),seconds,deckSize);
}

function saveCardsStats(score,time,deck){
  let cardsStats=JSON.parse(localStorage.getItem('cardsStats'))||[];
  cardsStats.push({
    date:new Date().toISOString().split('T')[0],
    deck:deck,
    score:score,
    time:time
  });
  localStorage.setItem('cardsStats',JSON.stringify(cardsStats));
}

function getSuitSymbol(suit){
  switch(suit){
    case 'hearts': return '♥';
    case 'diamonds': return '♦';
    case 'clubs': return '♣';
    case 'spades': return '♠';
  }
}
</script>

</body>
</html>
